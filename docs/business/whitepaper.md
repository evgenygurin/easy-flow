# White Paper — AI Customer Support Platform for E‑commerce (Easy‑Flow)

## Аннотация (Executive Summary)
Easy‑Flow — платформа интеллектуальной клиентской поддержки для e‑commerce с управляемым диалоговым потоком (state machine), гибридным NLP/AI‑ядром и модульными интеграциями. Решение оптимизирует нагрузку на поддержку, повышает удовлетворённость клиентов и ускоряет решение типовых запросов (заказы, доставка, оплата), обеспечивая прозрачную эскалацию к оператору при сложных кейсах.

Ключевые отличия:
- Управляемая диалоговая машина состояний (контролируемость, детерминируемость, расширяемость)
- Гибридный NLP/AI: шаблоны → база знаний → LLM fallback
- Омниканальность и e‑commerce интеграции (RU‑рынок в фазе 1, интернациональные — в фазе 2)
- Прозрачные метрики качества (FCR, доля эскалаций, время ответа)

## Проблема
Контакт‑центры e‑commerce сталкиваются с большим объёмом повторяющихся запросов (статус заказа, адрес/время доставки, проблемы оплаты, возвраты). Ручное обслуживание дорого и долго, а «чёрный ящик» LLM без контроля ухудшает консистентность и комплаенс.

## Решение
Easy‑Flow соединяет управляемый state‑driven диалог с гибридным AI:
- NLP извлекает намерение и сущности, определяет язык и тональность
- AI‑слой отвечает последовательно: шаблоны → база знаний → LLM (OpenAI/YandexGPT)
- Flow управляет маршрутами диалога, избегает зацикливаний, эскалирует при рисках
- Интеграции (адаптеры) обеспечивают связь с платформами, платежами, мессенджерами

## Целевая аудитория и сценарии
- Интернет‑магазины и маркетплейс‑селлеры (SMB/Enterprise)
- Контакт‑центры, аутсорс‑поддержка
- Сценарии: приветствие, проверка/изменение заказа, доставка (стоимость/время/трек), оплата (способы/ошибки/возвраты), эскалация

## Архитектура и стек
- Clean Architecture: Presentation (FastAPI, контроллеры) → Services (NLP/AI/Flow/Integrations) → Repositories/Models → Adapters
- Ядро диалога: Conversation Flow (состояния `hello`, `order`, `payment`, `shipping`, `hangup`)
- NLPService: паттерны интентов/сущностей, эвристики языка и тональности
- AIService: шаблоны, поиск по базе знаний (включая embeddings), LLM‑fallback (OpenAI/YandexGPT)
- Конфигурация: Pydantic Settings; кэш: Redis; БД: PostgreSQL (через репозитории)
- Стек: Python 3.12, FastAPI, SQLAlchemy, Redis, OpenAI/YandexGPT, sentence‑transformers, structlog

## Почему state machine
- Контроль и объяснимость: чёткие переходы, доступные действия, причины эскалаций
- Расширяемость: добавление/настройка состояний и политик без изменения ядра
- UX‑стабильность: предсказуемые шаги, менее «галлюцинаторный» опыт для клиента

## AI/NLP стратегия
- NLP: быстрая классификация на паттернах с эвристиками; далее гибридный экстрактор сущностей
- AI: каскад ответов — быстрые шаблоны для частых интентов; база знаний (ключевые слова + embeddings) — консистентные факты; LLM — только когда необходимо
- Кэширование ответов; обучение на неизвестных запросах (обратная связь в KB)

## Данные, приватность, комплаенс
- Минимизация PII; хранение токенов в секретах; журналирование без лишних персональных данных
- Соответствие 152‑ФЗ (RU) и GDPR (по мере интернационализации)
- Настраиваемые политики хранения истории диалогов и удаления

## Безопасность
- Секреты через переменные окружения/Secret‑менеджеры
- Роли и доступы (план): изоляция окружений, least privilege
- Статический анализ (Ruff, Bandit, Safety), проверка зависимостей

## Производительность и масштабирование
- Горизонтальное масштабирование API (Uvicorn/Gunicorn/K8s)
- Кэширование AI‑ответов, подготовка embeddings индексов
- Асинхронные вызовы внешних API; очереди (план) для долгих операций

## Метрики и аналитика
- FCR, доля эскалаций, среднее время ответа, глубина диалога, CSAT
- Технические метрики: ошибки, латентность, распределение состояний, число активных сессий

## Интеграции (экосистема)
- Фаза 1 (RU): Wildberries, Ozon, 1C‑Bitrix, InSales; мессенджеры: Telegram/WhatsApp
- Фаза 2 (INTL): Shopify, WooCommerce, BigCommerce, Magento; голосовые ассистенты
- Платежи: YooKassa (первый шаг), расширение по запросу

## Дорожная карта
- MVP (0–3 мес): базовые состояния и эскалация, KB+шаблоны+LLM fallback, моки интеграций, метрики
- Рост (3–9 мес): реальные интеграции фазы 1, панель метрик, расширение интентов/сущностей
- Масштаб (9–18+ мес): международные платформы, дополнительные каналы, строгие политики данных

## Go‑to‑Market (стратегия и тактика)
- Пилоты с магазинами среднего размера (RU), быстрые интеграции через моки
- Пакеты решений по отраслям (электроника, одежда, маркетплейс‑селлеры)
- Каналы: партнёры‑интеграторы, маркетплейсы приложений (Bitrix, Shopify — позже)

## Модель монетизации
- Подписка по уровням: Basic (шаблоны+KB), Pro (LLM, расширенные интеграции), Enterprise (SLA, кастом)
- Оверхеды за токены LLM/embeddings; скидки при годовой оплате

## Риски и смягчения
- Точность интентов: юнит‑тесты, A/B вариантов паттернов, обратная связь в KB
- Интеграционные лимиты: ретраи/ограничители, деградация в моки, прогресс‑индикаторы
- Комплаенс: data governance, журналирование доступа, политики хранения

## План внедрения (первые 4–6 недель)
1. Аудит и настройка окружения; цель — зелёные тесты, чистый линт
2. Наполнение KB, актуализация шаблонов, отладка fallback‑логики
3. Настройка моку интеграций, параметры `.env`, тестовые сценарии
4. Пилот у 1–2 клиентов, сбор метрик/обратной связи, корректировки

## Заключение
Easy‑Flow сочетает контроль и гибкость: state‑machine для управляемого UX и гибридный AI для качества ответов. Платформа ускоряет путь к отдаче, снижая стоимость поддержки, сохраняя масштабируемость и комплаенс.

## Приложения
- API (см. `docs/api/endpoints.md`)
- Архитектура и Flow (см. `docs/architecture/*`)
- Разработка и деплой (см. `docs/development/*`, `docs/deployment/*`)
- MVP план и бизнес‑обзор (см. `docs/mvp/plan.md`, `docs/business/overview.md`)
