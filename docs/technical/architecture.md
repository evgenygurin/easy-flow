# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã Easy Flow

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

Easy Flow –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö **Clean Architecture** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–ª–æ–µ–≤ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏.

### –î–∏–∞–≥—Ä–∞–º–º–∞ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Web Client    ‚îÇ    ‚îÇ  Mobile Apps    ‚îÇ    ‚îÇ  Messengers     ‚îÇ
‚îÇ   (React/Vue)   ‚îÇ    ‚îÇ (iOS/Android)   ‚îÇ    ‚îÇ (TG/WA/VK)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                      ‚îÇ                      ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 API Gateway                          ‚îÇ
        ‚îÇ              (FastAPI + Routes)                      ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ               Controllers Layer                       ‚îÇ
        ‚îÇ    (HTTP Logic, Validation, Response Formatting)     ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ              Business Logic Layer                    ‚îÇ
        ‚îÇ     (Services: Conversation, NLP, AI, Messaging)    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ            ‚îÇ            ‚îÇ           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ Repository  ‚îÇ ‚îÇ Adapters  ‚îÇ ‚îÇ External ‚îÇ ‚îÇ Cache  ‚îÇ
        ‚îÇ   Layer     ‚îÇ ‚îÇ  Layer    ‚îÇ ‚îÇ   APIs   ‚îÇ ‚îÇ (Redis)‚îÇ
        ‚îÇ(PostgreSQL) ‚îÇ ‚îÇ(Platforms)‚îÇ ‚îÇ(AI/ML)   ‚îÇ ‚îÇ        ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. Presentation Layer (API)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/api/`

#### Controllers (`app/api/controllers/`)
- **BaseController**: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- **ConversationController**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ —Å AI
- **MessagingController**: –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- **IntegrationController**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º

**–ü—Ä–∏–Ω—Ü–∏–ø—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤:**
```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - —Ç–æ–ª—å–∫–æ HTTP –ª–æ–≥–∏–∫–∞
class MessagingController(BaseController):
    async def send_message(self, request: SendMessageRequest) -> SendMessageResponse:
        validated_request = self._validate_request(request)  # HTTP –≤–∞–ª–∏–¥–∞—Ü–∏—è
        result = await self.messaging_service.send_message(validated_request)  # –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        return self._format_response(result)  # HTTP —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
class MessagingController:
    async def send_message(self, request):
        # –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã - —ç—Ç–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞!
        adapter = TelegramAdapter(token=request.token)
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è - —ç—Ç–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞!
        telegram_message = convert_to_telegram_format(request.message)
```

#### Routes (`app/api/routes/`)
- **–ú–∞–∫—Å–∏–º—É–º 10 —Å—Ç—Ä–æ–∫** –Ω–∞ endpoint
- –¢–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º

```python
@router.post("/chat")
async def process_chat_message(
    request: ChatRequest,
    controller: ConversationController = Depends(get_conversation_controller)
) -> ChatResponse:
    return await controller.process_chat_message(request)
```

### 2. Business Logic Layer (Services)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/services/`

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

##### ConversationService
```python
class ConversationService:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ –∏ AI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏."""
    
    async def process_conversation(
        self, user_id: str, session_id: str, message: str
    ) -> ConversationResult:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
        context = await self.conversation_repository.get_context(session_id)
        
        # NLP –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
        nlp_result = await self.nlp_service.analyze_message(message)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ AI
        ai_response = await self.ai_service.generate_response(
            message, context, nlp_result
        )
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É
        await self.conversation_repository.save_message(...)
        
        return ConversationResult(response=ai_response, intent=nlp_result.intent)
```

##### MessagingService
```python
class MessagingService:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã."""
    
    def __init__(self, integration_repository: IntegrationRepository):
        self._adapters: dict[str, MessagingAdapter] = {}
        self._register_adapters()
    
    async def send_message(
        self, platform: str, chat_id: str, message: UnifiedMessage
    ) -> DeliveryResult:
        adapter = self._get_adapter(platform)
        return await adapter.send_message(chat_id, message)
```

##### IntegrationService
```python
class IntegrationService:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏."""
    
    async def connect_platform(
        self, user_id: str, platform: str, credentials: dict
    ) -> ConnectionResult:
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        await self._validate_credentials(platform, credentials)
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        connection = await self._create_connection(platform, credentials)
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ
        await self.integration_repository.save_connection(user_id, connection)
        
        return ConnectionResult(success=True, platform_id=connection.id)
```

### 3. Data Access Layer (Repositories)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/repositories/`

#### Repository Pattern

##### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (`app/repositories/interfaces/`)
```python
class ConversationRepository(ABC):
    @abstractmethod
    async def get_session_history(
        self, session_id: str, limit: int = 50
    ) -> list[Message]:
        pass
    
    @abstractmethod
    async def save_message(self, message: Message) -> str:
        pass
```

##### –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (`app/repositories/sqlalchemy/`)
```python
class SQLAlchemyConversationRepository(ConversationRepository):
    async def get_session_history(
        self, session_id: str, limit: int = 50
    ) -> list[Message]:
        async with self.session() as session:
            result = await session.execute(
                select(MessageModel)
                .where(MessageModel.session_id == session_id)
                .order_by(MessageModel.created_at.desc())
                .limit(limit)
            )
            return [self._to_domain_model(row) for row in result.scalars()]
```

### 4. External Adapters Layer

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/adapters/`

#### Messaging Adapters
```python
class MessagingAdapter(ABC):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤."""
    
    @abstractmethod
    async def send_message(
        self, chat_id: str, message: UnifiedMessage, priority: int = 0
    ) -> DeliveryResult:
        pass
    
    @abstractmethod
    async def receive_webhook(
        self, payload: dict[str, Any], signature: str | None = None
    ) -> list[UnifiedMessage]:
        pass

class TelegramAdapter(MessagingAdapter):
    """Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è."""
    
    async def send_message(
        self, chat_id: str, message: UnifiedMessage, priority: int = 0
    ) -> DeliveryResult:
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Telegram —Ñ–æ—Ä–º–∞—Ç
        telegram_message = self._convert_to_telegram_format(message)
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Bot API
        sent_message = await self.bot.send_message(
            chat_id=int(chat_id),
            text=telegram_message["text"],
            reply_markup=telegram_message.get("reply_markup"),
        )
        
        return DeliveryResult(
            message_id=message.message_id,
            platform_message_id=str(sent_message.message_id),
            platform="telegram",
            status=DeliveryStatus.SENT,
            success=True,
        )
```

#### E-commerce Adapters
```python
class EcommerceAdapter(ABC):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è e-commerce –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π."""
    
    @abstractmethod
    async def get_orders(
        self, user_credentials: dict, filters: OrderFilters
    ) -> list[Order]:
        pass

class WildberriesAdapter(EcommerceAdapter):
    async def get_orders(
        self, user_credentials: dict, filters: OrderFilters
    ) -> list[Order]:
        # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Wildberries API
        pass
```

## Domain Models

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/models/`

### UnifiedMessage
```python
class UnifiedMessage(BaseModel):
    """–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º."""
    
    message_id: str
    platform: str  # telegram, whatsapp, vk, viber
    platform_message_id: str
    user_id: str
    chat_id: str
    
    text: str | None = None
    message_type: MessageType = MessageType.TEXT
    direction: MessageDirection = MessageDirection.OUTBOUND
    
    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    inline_keyboard: InlineKeyboard | None = None
    reply_keyboard: ReplyKeyboard | None = None
    
    # –ú–µ–¥–∏–∞
    attachments: list[MessageAttachment] = []
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    reply_to_message_id: str | None = None
    timestamp: datetime = Field(default_factory=datetime.now)
    metadata: dict[str, Any] = {}
```

### ConversationContext
```python
class ConversationContext(BaseModel):
    session_id: str
    user_id: str
    platform: str
    current_state: str
    context_data: dict[str, Any]
    created_at: datetime
    updated_at: datetime
```

## Dependency Injection

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `app/api/dependencies.py`

```python
def get_conversation_controller() -> ConversationController:
    return ConversationController(
        conversation_service=get_conversation_service(),
        nlp_service=get_nlp_service(),
    )

def get_conversation_service() -> ConversationService:
    return ConversationService(
        conversation_repository=get_conversation_repository(),
        nlp_service=get_nlp_service(),
        ai_service=get_ai_service(),
    )

def get_conversation_repository() -> ConversationRepository:
    return SQLAlchemyConversationRepository(
        session_factory=get_database_session_factory()
    )
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Repository Pattern
- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. Adapter Pattern
- –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
- –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–∏

### 3. Dependency Injection
- –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ì–∏–±–∫–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 4. Strategy Pattern
- –í—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ AI Service –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏

### 5. Chain of Responsibility
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ NLP Service
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤

## –ü—Ä–∏–Ω—Ü–∏–ø—ã SOLID

### Single Responsibility Principle (SRP)
- –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ HTTP –ª–æ–≥–∏–∫—É
- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç –æ–¥–Ω—É –±–∏–∑–Ω–µ—Å-–æ–±–ª–∞—Å—Ç—å
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –æ—Ç–≤–µ—á–∞—é—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

### Open/Closed Principle (OCP)
- –ù–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### Liskov Substitution Principle (LSP)
- –í—Å–µ –∞–¥–∞–ø—Ç–µ—Ä—ã –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### Interface Segregation Principle (ISP)
- –†–∞–∑–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∞–¥–∞–ø—Ç–µ—Ä–∞

### Dependency Inversion Principle (DIP)
- –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- Stateless —Å–µ—Ä–≤–∏—Å—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è —Å–µ—Å—Å–∏–π
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (async/await)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Redis
- Connection pooling –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ (structlog)
- –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
- Health checks

---

ü§ñ –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é [Claude Code](https://claude.ai/code)