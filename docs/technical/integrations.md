# üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

## –û–±–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

Easy Flow –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ —á–µ—Ä–µ–∑ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–∞–ø—Ç–µ—Ä–æ–≤.

### –¢–∏–ø—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

1. **E-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã** - Wildberries, Ozon, 1C-Bitrix, Shopify
2. **–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã** - Telegram, WhatsApp, VK, Viber  
3. **AI —Å–µ—Ä–≤–∏—Å—ã** - OpenAI GPT, YandexGPT, Anthropic Claude
4. **–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã** - YooKassa, Stripe, PayPal
5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - Google Analytics, –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

```
External APIs          Adapter Layer           Service Layer           Data Layer
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Wildberries ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ WB Adapter  ‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îÇ Ozon        ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Ozon Adapter‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Integration ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ PostgreSQL  ‚îÇ
‚îÇ 1C-Bitrix   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Bitrix      ‚îÇ        ‚îÇ   Service   ‚îÇ        ‚îÇ   Database  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îÇ Adapter     ‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îÇ Shopify     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Shopify     ‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ Adapter     ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Telegram    ‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îÇ Adapter     ‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îÇ WhatsApp    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Messaging   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    Redis    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îÇ WhatsApp    ‚îÇ        ‚îÇ   Service   ‚îÇ        ‚îÇ    Cache    ‚îÇ
‚îÇ VK          ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Adapter     ‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îÇ Viber       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ VK/Viber    ‚îÇ        ‚îÇ             ‚îÇ        ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ Adapters    ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## E-commerce –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Wildberries Integration

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
class WildberriesConfig(BaseConfig):
    api_key: str
    supplier_id: str
    base_url: str = "https://suppliers-api.wildberries.ru"
    rate_limit: int = 100  # –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
```

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
```python
class WildberriesAdapter(EcommerceAdapter):
    async def get_orders(
        self, 
        filters: OrderFilters = None,
        limit: int = 1000
    ) -> list[Order]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —Å WB."""
        
    async def get_order_details(self, order_id: str) -> OrderDetails:
        """–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞."""
        
    async def get_products(
        self, 
        filters: ProductFilters = None
    ) -> list[Product]:
        """–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤."""
        
    async def update_product_stock(
        self, 
        product_id: str, 
        quantity: int
    ) -> bool:
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤."""
        
    async def get_analytics(
        self, 
        date_from: date, 
        date_to: date
    ) -> AnalyticsData:
        """–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ."""
```

#### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö WB
```
WB API ‚îÄ‚îÄ‚Üí WB Adapter ‚îÄ‚îÄ‚Üí Integration Service ‚îÄ‚îÄ‚Üí Database
   ‚îÇ                          ‚îÇ
   ‚îÇ                          ‚ñº
   ‚îÇ                    Conversation Service
   ‚îÇ                          ‚îÇ
   ‚îÇ                          ‚ñº
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ Webhook ‚îÄ‚îÄ‚Üí Message Processing ‚îÄ‚îÄ‚Üí User Response
```

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
wb_adapter = WildberriesAdapter(
    api_key=credentials["api_key"],
    supplier_id=credentials["supplier_id"]
)

orders = await wb_adapter.get_orders(
    filters=OrderFilters(
        status="new",
        date_from=date(2024, 1, 1)
    )
)

for order in orders:
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É
    await order_repository.save(order)
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É
    if order.status == "shipped":
        await messaging_service.send_notification(
            user_id=order.user_id,
            template="order_shipped",
            data={"order_id": order.id}
        )
```

### Ozon Integration

#### API endpoints
```python
class OzonAdapter(EcommerceAdapter):
    BASE_URL = "https://api-seller.ozon.ru"
    
    async def get_orders(self) -> list[Order]:
        """POST /v3/posting/fbs/list"""
        
    async def get_products(self) -> list[Product]:
        """POST /v2/product/list"""
        
    async def update_stock(self, product_id: str, stock: int) -> bool:
        """POST /v1/product/import/stocks"""
```

### 1C-Bitrix Integration

#### CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
class BitrixAdapter(CRMAdapter):
    async def sync_contacts(self) -> list[Contact]:
        """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤."""
        
    async def create_deal(self, deal_data: DealData) -> str:
        """–°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏."""
        
    async def get_company_info(self, company_id: str) -> Company:
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏."""
```

## Messaging –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Telegram Bot Integration

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook
```python
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è webhook
await bot.set_webhook(
    url=f"{settings.webhook_base_url}/api/v1/messaging/webhook/telegram",
    secret_token=settings.telegram_webhook_secret,
    allowed_updates=["message", "callback_query", "inline_query"]
)
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
```python
class TelegramAdapter(MessagingAdapter):
    async def receive_webhook(
        self, 
        payload: dict[str, Any], 
        signature: str | None = None
    ) -> list[UnifiedMessage]:
        # –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏
        if not self._verify_signature(payload, signature):
            raise SecurityError("Invalid webhook signature")
            
        messages = []
        
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        if "message" in payload:
            tg_message = payload["message"]
            unified_message = self._convert_telegram_message(tg_message)
            messages.append(unified_message)
            
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ callback query
        if "callback_query" in payload:
            callback = payload["callback_query"]
            unified_message = self._convert_callback_query(callback)
            messages.append(unified_message)
            
        return messages
    
    async def send_message(
        self, 
        chat_id: str, 
        message: UnifiedMessage, 
        priority: int = 0
    ) -> DeliveryResult:
        try:
            # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Telegram —Ñ–æ—Ä–º–∞—Ç
            tg_data = self._convert_to_telegram_format(message)
            
            # –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Bot API
            if message.inline_keyboard:
                sent = await self.bot.send_message(
                    chat_id=int(chat_id),
                    text=tg_data["text"],
                    reply_markup=tg_data["reply_markup"],
                    parse_mode=ParseMode.HTML
                )
            else:
                sent = await self.bot.send_message(
                    chat_id=int(chat_id),
                    text=tg_data["text"],
                    parse_mode=ParseMode.HTML
                )
                
            return DeliveryResult(
                message_id=message.message_id,
                platform_message_id=str(sent.message_id),
                platform="telegram",
                status=DeliveryStatus.SENT,
                success=True,
                sent_at=datetime.now()
            )
            
        except TelegramError as e:
            return DeliveryResult(
                message_id=message.message_id,
                platform="telegram",
                status=DeliveryStatus.FAILED,
                success=False,
                error_message=str(e)
            )
```

### WhatsApp Business Integration

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
class WhatsAppConfig(BaseConfig):
    access_token: str
    phone_number_id: str
    webhook_verify_token: str
    webhook_secret: str
    base_url: str = "https://graph.facebook.com/v18.0"
```

#### –û—Ç–ø—Ä–∞–≤–∫–∞ —à–∞–±–ª–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
```python
async def send_template_message(
    self, 
    chat_id: str, 
    template_name: str, 
    parameters: list[str]
) -> DeliveryResult:
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è WhatsApp."""
    
    data = {
        "messaging_product": "whatsapp",
        "to": chat_id,
        "type": "template",
        "template": {
            "name": template_name,
            "language": {"code": "ru"},
            "components": [
                {
                    "type": "body",
                    "parameters": [
                        {"type": "text", "text": param} 
                        for param in parameters
                    ]
                }
            ]
        }
    }
    
    response = await self.http_client.post(
        f"{self.base_url}/{self.phone_number_id}/messages",
        json=data,
        headers={"Authorization": f"Bearer {self.access_token}"}
    )
    
    if response.status_code == 200:
        result = response.json()
        return DeliveryResult(
            platform_message_id=result["messages"][0]["id"],
            status=DeliveryStatus.SENT,
            success=True
        )
```

### VK Bot Integration

#### Callback API
```python
class VKAdapter(MessagingAdapter):
    async def receive_webhook(
        self, 
        payload: dict[str, Any], 
        signature: str | None = None
    ) -> list[UnifiedMessage]:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        if payload.get("type") == "confirmation":
            return []  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç confirmation_token
            
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        if payload.get("type") == "message_new":
            vk_message = payload["object"]["message"]
            return [self._convert_vk_message(vk_message)]
            
        return []
```

## AI Service –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### OpenAI Integration

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
```python
class OpenAIConfig(BaseConfig):
    api_key: str
    model: str = "gpt-4o-mini"
    max_tokens: int = 1000
    temperature: float = 0.7
    timeout: int = 30
```

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
```python
class OpenAIAdapter(AIAdapter):
    async def generate_response(
        self, 
        messages: list[Message], 
        context: ConversationContext
    ) -> AIResponse:
        
        # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
        system_prompt = self._build_system_prompt(context)
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç OpenAI
        openai_messages = [
            {"role": "system", "content": system_prompt}
        ]
        
        for msg in messages[-10:]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
            openai_messages.append({
                "role": "user" if msg.role == MessageRole.USER else "assistant",
                "content": msg.content
            })
            
        # –í—ã–∑–æ–≤ API
        response = await self.client.chat.completions.create(
            model=self.config.model,
            messages=openai_messages,
            max_tokens=self.config.max_tokens,
            temperature=self.config.temperature,
            timeout=self.config.timeout
        )
        
        return AIResponse(
            content=response.choices[0].message.content,
            model=self.config.model,
            usage=TokenUsage(
                prompt_tokens=response.usage.prompt_tokens,
                completion_tokens=response.usage.completion_tokens,
                total_tokens=response.usage.total_tokens
            )
        )
```

### YandexGPT Integration

#### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
```python
class YandexGPTAdapter(AIAdapter):
    BASE_URL = "https://llm.api.cloud.yandex.net"
    
    async def generate_response(
        self, 
        messages: list[Message], 
        context: ConversationContext
    ) -> AIResponse:
        
        # YandexGPT —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        request_data = {
            "modelUri": f"gpt://{self.folder_id}/{self.model_name}",
            "completionOptions": {
                "stream": False,
                "temperature": self.temperature,
                "maxTokens": self.max_tokens
            },
            "messages": self._convert_messages(messages)
        }
        
        headers = {
            "Authorization": f"Api-Key {self.api_key}",
            "Content-Type": "application/json"
        }
        
        response = await self.http_client.post(
            f"{self.BASE_URL}/foundationModels/v1/completion",
            json=request_data,
            headers=headers
        )
```

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Ç–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Scheduler      ‚îÇ    ‚îÇ  Sync Service   ‚îÇ    ‚îÇ   Adapters      ‚îÇ
‚îÇ  (Celery/APScheduler)‚îÇ  (Orchestrator) ‚îÇ    ‚îÇ (Platform APIs) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                      ‚îÇ                      ‚îÇ
          ‚îÇ 1. Trigger sync      ‚îÇ                      ‚îÇ
          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                      ‚îÇ
          ‚îÇ                      ‚îÇ 2. Get integration   ‚îÇ
          ‚îÇ                      ‚îÇ    credentials       ‚îÇ
          ‚îÇ                      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
          ‚îÇ                      ‚îÇ                      ‚îÇ 3. Fetch data
          ‚îÇ                      ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    from API
          ‚îÇ                      ‚îÇ                      ‚îÇ
          ‚îÇ                      ‚îÇ 4. Process & store   ‚îÇ
          ‚îÇ                      ‚îÇ    data              ‚îÇ
          ‚îÇ                      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
          ‚îÇ                      ‚îÇ                ‚îÇ     ‚îÇ
          ‚îÇ                      ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
          ‚îÇ 5. Update status     ‚îÇ                      ‚îÇ
          ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                      ‚îÇ
          ‚îÇ                      ‚îÇ                      ‚îÇ
```

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```python
class SyncScheduler:
    def __init__(self, integration_service: IntegrationService):
        self.integration_service = integration_service
        self.scheduler = AsyncIOScheduler()
        
    async def start(self):
        """–ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞."""
        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
        self.scheduler.add_job(
            self.sync_all_orders,
            'interval',
            minutes=15,
            id='sync_orders'
        )
        
        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞–∂–¥—ã–π —á–∞—Å
        self.scheduler.add_job(
            self.sync_all_products,
            'interval',
            hours=1,
            id='sync_products'
        )
        
        self.scheduler.start()
        
    async def sync_all_orders(self):
        """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π."""
        integrations = await self.integration_service.get_active_integrations(
            platform_type=PlatformType.ECOMMERCE
        )
        
        for integration in integrations:
            try:
                await self.integration_service.sync_orders(
                    integration_id=integration.id,
                    sync_type=SyncType.INCREMENTAL
                )
            except Exception as e:
                logger.error(
                    "Order sync failed",
                    integration_id=integration.id,
                    error=str(e)
                )
```

### Error Handling –∏ Retry –ª–æ–≥–∏–∫–∞

```python
@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=4, max=60),
    retry=retry_if_exception_type((ConnectionError, TimeoutError))
)
async def sync_orders_with_retry(
    self, 
    integration: Integration
) -> SyncResult:
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏."""
    
    adapter = self.adapter_factory.get_adapter(integration.platform_id)
    
    try:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API
        orders = await adapter.get_orders(
            credentials=integration.credentials,
            last_sync=integration.last_sync_at
        )
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É
        saved_count = 0
        errors = []
        
        for order in orders:
            try:
                await self.order_repository.upsert(order)
                saved_count += 1
            except Exception as e:
                errors.append({
                    "order_id": order.id,
                    "error": str(e)
                })
                
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
        await self.integration_repository.update_sync_status(
            integration_id=integration.id,
            last_sync_at=datetime.now(),
            sync_result=SyncResult(
                records_synced=saved_count,
                errors=errors
            )
        )
        
        return SyncResult(
            success=True,
            records_synced=saved_count,
            errors=errors
        )
        
    except Exception as e:
        logger.error(
            "Sync failed",
            integration_id=integration.id,
            error=str(e)
        )
        
        await self.integration_repository.update_sync_status(
            integration_id=integration.id,
            sync_result=SyncResult(
                success=False,
                error_message=str(e)
            )
        )
        
        raise
```

## Webhooks

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π webhook handler

```python
@router.post("/webhook/{platform}")
async def handle_webhook(
    platform: str,
    request: Request,
    messaging_controller: MessagingController = Depends()
):
    """–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhooks –æ—Ç –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º."""
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ payload
    if request.headers.get("content-type") == "application/json":
        payload = await request.json()
    else:
        payload = await request.form()
        
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
    signature = request.headers.get("x-signature") or \
               request.headers.get("x-hub-signature-256") or \
               request.headers.get("x-telegram-bot-api-secret-token")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ webhook –∑–∞–ø—Ä–æ—Å–∞
    webhook_request = WebhookRequest(
        platform=platform,
        payload=payload,
        signature=signature,
        headers=dict(request.headers)
    )
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
    result = await messaging_controller.process_webhook(webhook_request)
    
    # –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    if platform == "telegram":
        return {"ok": True}
    elif platform == "whatsapp":
        return {"status": "ok"}
    elif platform == "vk":
        if payload.get("type") == "confirmation":
            return settings.vk_confirmation_token
        return "ok"
    
    return result
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å webhooks

```python
class WebhookSecurity:
    @staticmethod
    def verify_telegram_signature(
        payload: dict, 
        signature: str, 
        secret: str
    ) -> bool:
        """–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ Telegram webhook."""
        if not signature:
            return False
            
        expected = hmac.new(
            secret.encode(),
            json.dumps(payload, separators=(',', ':')).encode(),
            hashlib.sha256
        ).hexdigest()
        
        return hmac.compare_digest(signature, expected)
    
    @staticmethod  
    def verify_whatsapp_signature(
        payload: bytes,
        signature: str,
        secret: str
    ) -> bool:
        """–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ WhatsApp webhook."""
        if not signature.startswith("sha256="):
            return False
            
        expected = hmac.new(
            secret.encode(),
            payload,
            hashlib.sha256
        ).hexdigest()
        
        received = signature.removeprefix("sha256=")
        return hmac.compare_digest(expected, received)
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### –ú–µ—Ç—Ä–∏–∫–∏
```python
class IntegrationMetrics:
    def __init__(self, prometheus_registry):
        self.api_calls = Counter(
            'integration_api_calls_total',
            'Total API calls to external platforms',
            ['platform', 'method', 'status'],
            registry=prometheus_registry
        )
        
        self.response_time = Histogram(
            'integration_api_response_seconds',
            'API response time in seconds',
            ['platform', 'method'],
            registry=prometheus_registry
        )
        
        self.sync_success = Counter(
            'integration_sync_success_total',
            'Successful sync operations',
            ['platform', 'sync_type'],
            registry=prometheus_registry
        )
        
    def record_api_call(
        self, 
        platform: str, 
        method: str, 
        status: str,
        duration: float
    ):
        self.api_calls.labels(
            platform=platform,
            method=method,
            status=status
        ).inc()
        
        self.response_time.labels(
            platform=platform,
            method=method
        ).observe(duration)
```

### Health Checks
```python
@router.get("/health/integrations")
async def integration_health_check(
    integration_service: IntegrationService = Depends()
):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π."""
    
    health_status = {
        "status": "healthy",
        "timestamp": datetime.now().isoformat(),
        "integrations": {}
    }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    for platform in ["wildberries", "ozon", "telegram", "whatsapp"]:
        try:
            # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
            adapter = adapter_factory.get_adapter(platform)
            status = await adapter.health_check()
            
            health_status["integrations"][platform] = {
                "status": "healthy" if status else "unhealthy",
                "last_check": datetime.now().isoformat()
            }
            
        except Exception as e:
            health_status["integrations"][platform] = {
                "status": "error",
                "error": str(e),
                "last_check": datetime.now().isoformat()
            }
            health_status["status"] = "degraded"
    
    return health_status
```

---

ü§ñ –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é [Claude Code](https://claude.ai/code)